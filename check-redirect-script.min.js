function empty(e){return""===e||0===e||"0"===e||null===e||!1===e||void 0===e}function numder_ex(e){return e=e||0,Number(e)}jQuery(document).ready(function(b){var r=0,c=b("#cr-submit-analysis").val();function n(){let a=0;return b(".cr-checkbox-post:checked").each(function(e,c){a+=Number(b(c).val())}),a}function o(e,c){return jQuery.ajax({url:e,type:"POST",data:c,cache:!1,dataType:"json",processData:!1,contentType:!1,success:function(e){return e},error:function(e,c,a){console.log("ОШИБКА AJAX запроса down: "+c,e)}})}b("#cr-submit-analysis").val(c+". Всего: 0 "),b(".cr-checkbox-post").on("click",function(){var e=n();b("#cr-submit-analysis").val(c+". Всего: "+e),0<e?b("#cr-submit-analysis").prop("disabled",!1):b("#cr-submit-analysis").prop("disabled",!0)}),b("#cr-submit-analysis").on("click",function(){let s=0,i=n();b(".cr-checkbox-post").prop("disabled","true"),b("#cr-submit-analysis").prop("disabled","true"),b("#cr-progress-bar-block").css({visibility:"visible"}),b("#cr-progress-bar").attr({value:s,max:i});let a=[];b(".cr-checkbox-post:checked").each(function(e,c){a.push(b(c).attr("data-post-type"))});let l=!1,d=need_change_ext_domain=need_change_media=need_change_absolute=0;b.each(a,function(e,c){let a=new FormData;a.append("action","analysis_link_type_posts"),a.append("post_type",c),a.append("post_id",123),url=cr_config.ajax_url,b.when(o(url,a)).then(function(e){var c=e.col;console.log(e),need_change_absolute+=c?numder_ex(c.absolute)+numder_ex(c.absolute_media)+numder_ex(c.absolute_root):0,need_change_media+=c?numder_ex(c.absolute_media)+numder_ex(c.relative_media):0,need_change_ext_domain+=c?numder_ex(c.z_other_domain):0,d+=c?numder_ex(c.relative):0;let a=b("#cr-label-checkbox-post-"+e.name),n=a.find("span"),t="",r=a.find(".cr-checkbox-post"),o=0;b.each(c,function(e,c){name_response=function(e){let c;switch(e){case"relative":c="- Относительных ссылок домена: ";break;case"relative_media":c="- Относительных медиа ссылок домена: ";break;case"relative_root":c="- Относительных корневых ссылок домена: ";break;case"absolute":c="- Абсолютных ссылок домена: ";break;case"absolute_media":c="- Абсолюnных медиа ссылок домена: ";break;case"absolute_root":c="- Абсолюnных корневых ссылок домена: ";break;case"z_other_domain":c="- Ссылки на другие домены: ";break;case"z_sub_domain":c="- Ссылки на свои поддомены: ";break;case"undefined":case"error":case"name":c="";break;default:c="- очень странная ошибка!"}return c}(e),""!==name_response&&(t+="<br>"+name_response+": "+c,o+=c)}),r.attr("data-link-summ",o),empty(t)?t+="<br>В данных публикациях нет ссылок":l=l||!0,n.css({color:"blue"}),n.html(t),s+=Number(a.find(".cr-checkbox-post").val()),b("#cr-progress-bar").attr({value:s}),s===i&&setTimeout(function(){if(b("#cr-progress-bar-block").css({visibility:"hidden"}),l){if(0<need_change_absolute){let e=b("#cr-label-checkbox-change-rep-abs-rel").find(".cr-checkbox-change");e.val(need_change_absolute),e.removeAttr("disabled");let c=b("#cr-label-checkbox-change-check-redir").find(".cr-checkbox-change");c.val(need_change_absolute+d),c.removeAttr("disabled")}if(0<need_change_media){let e=b("#cr-label-checkbox-change-check-media").find(".cr-checkbox-change");e.val(need_change_media),e.removeAttr("disabled")}if(0<need_change_ext_domain){let e=b("#cr-label-checkbox-change-check-ext").find(".cr-checkbox-change");e.val(need_change_ext_domain),e.removeAttr("disabled")}b("#change-links").css({visibility:"visible"}),b("#cr-submit-change").css({visibility:"visible"}),b("#cr-submit-change").prop("disabled",!0)}},1e3)},function(e){console.log("Странная ошибка счетчика")})})}),b(".cr-checkbox-change").on("click",function(){let e=b(this),c=e.next().find(".cr-checkbox-add-span");e.is(":checked")?c.html("Проверить всего ссылок: "+e.val()):c.html(""),0<b(".cr-checkbox-change:checked").length?b("#cr-submit-change").prop("disabled",!1):b("#cr-submit-change").prop("disabled",!0)}),b("#cr-submit-change").on("click",function(){console.log("cr-submit-change"),b("#cr-submit-change").prop("disabled",!0);let n=[];b(".cr-checkbox-post:checked").each(function(e,c){0<b(c).attr("data-link-summ")&&n.push(b(c).attr("data-post-type"))}),console.log(n);let t=[];b(".cr-checkbox-change:checked").each(function(e,c){t.push(b(c).attr("data-type-change"))}),console.log(t),b.each(n,function(e,c){let a=new FormData;a.append("action","check_redirection_type_posts"),a.append("post_type",c),a.append("type-change",t),a.append("post_id",123),a.append("count_posts_types",n.length-e),url=cr_config.ajax_url,b.when(function c(a,n){let t=0;b(".cr-checkbox-change:checked").each(function(){"rep-abs-rel"!==b(this).attr("data-type-change")&&(t+=+b(this).val())});b("#cr-progress-bar-block").css({visibility:"visible"});b("#cr-progress-bar").attr({value:r,max:t});b.when(o(a,n)).then(function(e){console.log(e),r+=e.col,b("#cr-progress-bar").attr({value:r}),e.response?c(a,n):r===t&&setTimeout(function(){b("#cr-progress-bar-block").css({visibility:"hidden"})},1500)},function(e){console.log("Странная ошибка счетчика")});return r}(url,a)).then(function(e){},function(e){console.log("Странная ошибка счетчика")})})})});